{% extends 'index.html' %} {% load static %} {% block content %}
<div class="container">
  <div class="text-center">Subject Register</div>

  <form method="post" id="subjectForm">
    {% csrf_token %}
    <div class="form-group">
      <select id="stream_id" name="stream" class="form-control">
        <option value="">Select Stream</option>
        {% for stream in streams %}
        <option value="{{stream.id}}">{{stream.name}}</option>
        {% endfor %}
      </select>
    </div>
    <br />
    <div class="form-group">
      <input type="hidden" id="subject_id" name="subject_id" />
      <label for="name">Name</label>
      <input
        type="text"
        class="form-control"
        id="subject_name"
        name="subject_name"
        required />
    </div>
    <br />
    <button id="subject_register_btn" class="btn btn-success">Save</button>
  </form>
  <hr />
  <div id="acknowledge"></div>

  <h2>Subject List</h2>

  <!-- START: Corrected Accordion Structure -->
  <div class="accordion" id="subjectAccordion">
    <!-- This is the outer loop that iterates through each stream -->
    {% for stream in streams %}
    <div class="accordion-item">
      <h2 class="accordion-header" id="heading-{{ stream.id }}">
        <button
          class="accordion-button collapsed"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#collapse-{{ stream.id }}"
          aria-expanded="false"
          aria-controls="collapse-{{ stream.id }}">
          <strong>{{ stream.name }}</strong>
        </button>
      </h2>
      <div
        id="collapse-{{ stream.id }}"
        class="accordion-collapse collapse"
        aria-labelledby="heading-{{ stream.id }}"
        data-bs-parent="#subjectAccordion">
        <div class="accordion-body">
          <ul class="list-group">
            {% for subject in stream.subject_set.all %} 
            {% include 'partial/subject_rows.html' %} {% empty %}
            <li class="list-group-item text-muted">
              No subjects have been added to this stream yet.
            </li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
    {% endfor %}
    <!-- FIX: This was the missing tag to close the outer stream loop -->
  </div>
  <!-- END: Corrected Accordion Structure -->
</div>
{% endblock %}
